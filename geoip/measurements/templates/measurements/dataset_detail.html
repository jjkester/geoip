{% extends 'base.html' %}
{% load i18n %}
{% block page_title %}{% blocktrans %}Data set {{ dataset }}{% endblocktrans %}{% endblock %}
{% block content %}
  <section class="container">
    <nav class="toolbar">
      <div class="btn-group">
        <a href="{% url 'measurements:dataset_list' %}" class="btn btn-default"><i class="glyphicon glyphicon-menu-left"></i> {% trans "Back to list" %}</a>
      </div>
      {% if user.is_staff %}
        <div class="btn-group">
          <button class="btn btn-warning disabled"><i class="glyphicon glyphicon-flash"></i> {% trans "Admin" %}</button>
          <a href="{% url 'admin:measurements_dataset_change' dataset.pk %}" class="btn btn-warning"><i class="glyphicon glyphicon-pencil"></i> {% trans "Edit" %} {% trans "data set" %}</a>
          <a href="{% url 'admin:measurements_dataset_delete' dataset.pk %}" class="btn btn-warning"><i class="glyphicon glyphicon-trash"></i> {% trans "Delete" %} {% trans "data set" %}</a>
        </div>
      {% endif %}
    </nav>

    <header class="page-header">
      <h1>
        {% trans "Data set" %}
        <small>{{ dataset }}</small>
      </h1>
    </header>

    <div class="row">
      <div class="col-xs-6 col-md-3">
        <h3>{% trans "Details" %}</h3>
        <dl>
          <dt>{% trans "ID" %}</dt>
          <dd>{{ dataset.hashid }}</dd>
          <dt>{% trans "Status" %}</dt>
          <dd>{{ dataset.get_status_display|capfirst }}</dd>
        </dl>
      </div>
      <div class="col-xs-6 col-md-3">
        <h3>{% trans "Point in time" %}</h3>
        <dl>
          <dt>{% trans "Start" %}</dt>
          <dd>{{ dataset.start|date:'Y-m-d H:i' }}</dd>
          <dt>{% trans "End" %}</dt>
          <dd>{{ dataset.end|date:'Y-m-d H:i' }}</dd>
        </dl>
      </div>
      <div class="col-sm-6 col-md-3">
        <h3>{% trans "Size" %}</h3>
        <dl>
          <dt>{% trans "Databases" %}</dt>
          <dd>{{ dataset.databases__count }}</dd>
          <dt>{% trans "Nodes" %}</dt>
          <dd>{{ dataset.nodes__count }}</dd>
        </dl>
      </div>
      <div class="col-sm-6 col-md-3">
        <h3>&nbsp;</h3>
        <dl>
          <dt>{% trans "Measurement points" %}</dt>
          <dd>{{ dataset.measurements.count }}</dd>
          <dt>{% trans "Run time" %}</dt>
          <dd>{{ dataset.run_time_now|timesince }}</dd>
        </dl>
      </div>
    </div>

    <hr>

    <div class="row">
      <div class="col-sm-4">
        <div class="panel panel-primary text-center">
          <div class="panel-body">
            <p class="h2">{{ statistics.accuracy_ipv4|floatformat }} km</p>
          </div>
          <div class="panel-footer">{% trans "Average IPv4 accuracy" %}</div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="panel panel-primary text-center">
          <div class="panel-body">
            <p class="h2">{{ statistics.accuracy_ipv6|floatformat }} km</p>
          </div>
          <div class="panel-footer">{% trans "Average IPv6 accuracy" %}</div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="panel panel-primary text-center">
          <div class="panel-body">
            <p class="h2">{{ statistics.accuracy_difference|floatformat }} km</p>
          </div>
          <div class="panel-footer">{% trans "Average difference" %}</div>
        </div>
      </div>
    </div>

    <hr>

    <h2>Comparison grids</h2>

    <h3>Averages</h3>
    <p>The table below contains the average accuracy for each database.</p>

    <table class="table table-bordered">
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th class="text-center">IPv4 accuracy</th>
          <th class="text-center">IPv6 accuracy</th>
          <th class="text-center">Mutual distance</th>
        </tr>
      </thead>
      <tbody>
        {% for result in database_results.averages %}
          <tr>
            <th>{{ result.database.name }}</th>
            <td class="text-center">{{ result.accuracy_ipv4|floatformat }} km</td>
            <td class="text-center">{{ result.accuracy_ipv6|floatformat }} km</td>
            <td class="text-center">{{ result.accuracy_difference|floatformat }} km</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <h3>Range accuracy</h3>
    <p>The table below contains the accuracy of each database for a number of fixed distances from the original location.</p>

    <table class="table table-bordered">
      <thead>
        <tr>
          <th colspan="2">&nbsp;</th>
          <th class="text-center">&lt; 1 km</th>
          <th class="text-center">&lt; 10 km</th>
          <th class="text-center">&lt; 25 km</th>
          <th class="text-center">&lt; 100 km</th>
          <th class="text-center">&lt; 250 km</th>
        </tr>
      </thead>
      <tbody>
        {% for result in database_results.ranges %}
          <tr>
            <th rowspan="2" style="vertical-align: middle;">{{ result.database.name }}</th>
            <th class="text-right">IPv4</th>
            <td class="text-center">{% widthratio result.v4.1 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v4.10 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v4.25 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v4.100 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v4.250 result.total 100 %}%</td>
          </tr>
          <tr>
            <th class="text-right">IPv6</th>
            <td class="text-center">{% widthratio result.v6.1 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v6.10 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v6.25 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v6.100 result.total 100 %}%</td>
            <td class="text-center">{% widthratio result.v6.250 result.total 100 %}%</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <hr>

    <p class="small text-muted">
      <strong>License notices:</strong><br>
      {% for database in databases %}
        {{ database.notes|safe }}
      {% endfor %}
    </p>

  </section>
{% endblock %}